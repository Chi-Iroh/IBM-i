-- Requirement: https://github.com/bobcozzi/BNDDIR_ENTRIES/blob/main/BNDDIR_ENTRIES.SQL
-- Lists all exported symbols of a bnddir

CREATE OR REPLACE FUNCTION SQLTOOLS.LIST_BNDDIR_SYMBOLS(
		library_name varchar(10),
		bnddir varchar(10)
	)
	RETURNS TABLE (
		PROGRAM_NAME varchar(10),
		OBJECT_TYPE varchar(7),
		SYMBOL_NAME  nvarchar(8192),
		SYMBOL_USAGE varchar(10),
		ARGUMENT_OPTIMIZATION varchar(4)
	)
	LANGUAGE SQL
	MODIFIES SQL DATA
	NOT DETERMINISTIC
	NOT FENCED
	SPECIFIC SQLTOOLS.LIST_BNDDIR_SYMBOLS
	RETURN
		SELECT PROGRAM_NAME, OBJECT_TYPE, SYMBOL_NAME, SYMBOL_USAGE, ARGUMENT_OPTIMIZATION
	  FROM QSYS2.PROGRAM_EXPORT_IMPORT_INFO
	WHERE PROGRAM_LIBRARY = library_name
		AND PROGRAM_NAME IN (SELECT OBJNAME FROM TABLE( sqltools.BNDDIR_ENTRIES(library_name, bnddir)));

-- SELECT * FROM TABLE (SQLTOOLS.LIST_BNDDIR_SYMBOLS('QSYS', 'QC2LE')); -- lists all symbols of QSYS/QC2LE
